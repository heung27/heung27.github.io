---
layout: post
title: Optional
date: 2022-02-19 13:32 +0900
categories: [Language, Java]
tags: [Java 8, Optional]
---



개발할 때 흔히 NPE(NullPointException)를 접하게 된다. null 값을 가진 객체를 참조하려고 할 때 발생하는 에러이다. NPE를 해결하기 위해서는 해당 객체가 null인지 검사하는 로직이 필요하다. 하지만 코드가 복잡해지고 검사해야 할 변수가 많아 질 수록 검사 로직 구현이 상당히 번거로워진다. 본문에서 이를 쉽게 처리할 수 있도록 도와주는 Optional 클래스를 소개한다.

<br>

## Optional 이란?

Optional은 Integer나 Double처럼 T 타입의 객체를 포장해주는 래퍼 클래스(Wrapper Class) 이다. 따라서 Optional 인스턴스는 모든 타입의 참조 변수를 저장할 수 있다. 

이러한 Optional 객체를 사용하면 제공되는 메소드로 예상치 못한 NPE을 간단히 회피할 수 있다. 즉, 복잡한 조건문 없이도 null 값으로 인해 발생하는 예외를 처리할 수 있게 된다.

참고로 Optional은 Java 8에서 추가되었다. 

<br>

## 사용법

Optional의 주요 메소드를 소개한다.

|                            메소드                            |                             설명                             |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
|                static <T> Optional<T> empty()                |  아무런 값도 가지지 않은 비어있는 Optional 객체를 반환한다.  |
|                           T get()                            |            Optional 객체에 저장된 값을 반환한다.             |
|                     boolean isPresent()                      | 저장된 값이 존재하면 true를 반환하고, 값이 존재하지 않으면 false를 반환한다. |
|              static <T> Optional<T> of(T value)              |   null이 아닌 명시된 값을 가지는 Optional 객체를 반환한다.   |
|          static <T> Optional<T> ofNullable(T value)          | 명시된 값이 null이 아니면 그 값을 가지는 Optional 객체를 반환하고, 명시된 값이 null이면 비어있는 Optional 객체를 반환한다. |
|                      T orElse(T other)                       | 저장된 값이 존재하면 그 값을 반환하고, 값이 존재하지 않으면 인수로 전달된 값을 반환한다. |
|           T orElseGet(Supplier<? extends T> other)           | 저장된 값이 존재하면 그 값을 반환하고, 값이 존재하지 않으면 인수로 전달된 람다 표현식의 결괏값을 반환한다. |
| <X extends Throwable> T orElseThrow(Supplier<? extends X>  exceptionSupplier) | 저장된 값이 존재하면 그 값을 반환하고, 값이 존재하지 않으면 인수로 전달된 예외를 발생시킨다. |
| <U> Optional<U> map(Function<? super T, ? extends U> mapper) | 값이 있으면 제공된 매핑 함수를 적용하고, 결과가 null이 아니면 결과를 설명하는 Optional을 반환한다. |

더 자세한 정보는 공식 문서를 참조하자.

공식 문서 : https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html

<br>

## 활용 예제

위에서 사용법을 알아 봤으니 예제를 통해 자세한 활용 방법을 알아보자.

### 생성

~~~java
Optional<String> userName = Optional.empty();

System.out.println(userName); // Optional.empty
System.out.println(userName.isEmpty()); // true
System.out.println(userName.isPresent()); // false
~~~

아무런 값도 가지지 않는 빈 객체는 위와 같이 생성할 수 있다.

~~~java
// getNmae()이 null이면 Optional.empty 반환
// null이 아니면 해당 문자열을 가지는 Optional 반환
Optional<User> optionalUser = Optional.ofNullable(getUser());
System.out.println(optionalUser);
~~~



<br>

### 객체 사용

```
// Optional에 저장된 값을 반환
// 비어있으면 NoSuchElementException 발생
User user = optionalUser.get();

// Optional에 저장된 값이 있으면 해당 값 반환
// 비어있으면 대체하는 새로운 객체 반환(unknown User)
user = optionalUser.orElse(new User("unknown"));

// Optional에 저장된 값이 있으면 해당 값 반환
// 비어있으면 람다식의 결과값(unknown User)을 반환
user = optionalUser.orElseGet(() -> new User("unknown"));

// Optional에 저장된 값이 있으면 해당 값 반환
// 비어있으면 예외를 throw
user = optionalUser.orElseThrow(() -> new RuntimeException());
```



<br>

## 주의할 점

Optional은 null 또는 실제 값을 value로 갖는 wrapper로 감싸서 NPE(NullPointerException)로부터 자유로워지기 위해 나온 Wrapper 클래스이다. 따라서 Optional을 반환하는 메소드는 절대 null을 갖는 value를 반환해서는 안된다. 

또한 Optional은 값을 Wrapping하고 다시 풀고, null일 경우에는 대체하는 함수를 호출하는 등의 오버헤드가 있으므로 성능이 저하될 수 있다. 그렇기 때문에 메소드의 반환 값이 절대 null이 아니라면 Optional을 사용하지 않는 것이 성능저하가 적다. 

즉, Optional은 메소드의 결과가 null이 될 수 있으며, 클라이언트가 이 상황을 처리해야 할 때 사용하는 것이 좋다.

<br>

## Reference

- [http://www.tcpschool.com/java/java_stream_optional](http://www.tcpschool.com/java/java_stream_optional)
- [https://www.latera.kr/blog/2019-07-02-effective-optional/#13-%EB%B3%80%ED%99%98%EC%97%90-map-%EA%B3%BC-flatmap-%EC%82%AC%EC%9A%A9%EC%9D%84-%EA%B3%A0%EB%A0%A4%ED%95%A0-%EA%B2%83](https://www.latera.kr/blog/2019-07-02-effective-optional/#13-%EB%B3%80%ED%99%98%EC%97%90-map-%EA%B3%BC-flatmap-%EC%82%AC%EC%9A%A9%EC%9D%84-%EA%B3%A0%EB%A0%A4%ED%95%A0-%EA%B2%83)
- [https://homoefficio.github.io/2019/10/03/Java-Optional-%EB%B0%94%EB%A5%B4%EA%B2%8C-%EC%93%B0%EA%B8%B0/](https://homoefficio.github.io/2019/10/03/Java-Optional-%EB%B0%94%EB%A5%B4%EA%B2%8C-%EC%93%B0%EA%B8%B0/)
- [https://mangkyu.tistory.com/70](https://mangkyu.tistory.com/70)
