<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Stream API - 고급" /><meta property="og:locale" content="en" /><meta name="description" content="지난번의 기본편에 이어 고급편을 준비했다. 본편에서는 조금 더 복잡한 Stream API 메서드들과 성능, 주의할 점에 대해 자세히 알아본다." /><meta property="og:description" content="지난번의 기본편에 이어 고급편을 준비했다. 본편에서는 조금 더 복잡한 Stream API 메서드들과 성능, 주의할 점에 대해 자세히 알아본다." /><link rel="canonical" href="https://github.com/heung27/posts/stream-api-%EA%B3%A0%EA%B8%89/" /><meta property="og:url" content="https://github.com/heung27/posts/stream-api-%EA%B3%A0%EA%B8%89/" /><meta property="og:site_name" content="H’s Tech Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-13T16:50:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Stream API - 고급" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-05T22:52:29+09:00","datePublished":"2022-03-13T16:50:00+09:00","description":"지난번의 기본편에 이어 고급편을 준비했다. 본편에서는 조금 더 복잡한 Stream API 메서드들과 성능, 주의할 점에 대해 자세히 알아본다.","headline":"Stream API - 고급","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/heung27/posts/stream-api-%EA%B3%A0%EA%B8%89/"},"url":"https://github.com/heung27/posts/stream-api-%EA%B3%A0%EA%B8%89/"}</script><title>Stream API - 고급 | H's Tech Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="H's Tech Blog"><meta name="application-name" content="H's Tech Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/me.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">H's Tech Blog</a></div><div class="site-subtitle font-italic">주니어 서버 개발자의 성장기</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/heung27" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['wlsgmd1535','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Stream API - 고급</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Stream API - 고급</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/heung27">Jin Heung An</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1647157800" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-03-13 </em> </span> <span> Updated <em class="timeago" data-ts="1649166749" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-05 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4684 words"> <em>26 min</em> read</span></div></div></div><div class="post-content"><p>지난번의 <a href="https://heung27.github.io/posts/stream-api-%EA%B8%B0%EB%B3%B8/">기본편</a>에 이어 고급편을 준비했다. 본편에서는 조금 더 복잡한 Stream API 메서드들과 성능, 주의할 점에 대해 자세히 알아본다.</p><p><br /></p><h2 id="1-parallel-stream">1. Parallel Stream <a href="#1-parallel-stream" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Stream API는 많은 양의 데이터를 처리하는 경우 런타임 성능을 높이기 위해 병렬 스트림(Parallel Stream)을 제공한다. Parallel Stream는 내부적으로 Java 7에서 도입된 Fork &amp; Join을 사용하고 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">);</span>

<span class="c1">// 병렬 스트림 생성</span>
<span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">parallelStream</span> <span class="o">=</span> <span class="n">strings</span><span class="o">.</span><span class="na">parallelStream</span><span class="o">();</span>

<span class="c1">// 병렬 여부 확인</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">parallelStream</span><span class="o">.</span><span class="na">isParallel</span><span class="o">());</span> <span class="c1">// true</span>
</pre></table></code></div></div><p>Parallel Stream을 생성하기 위해서는 Collection의 메서드 <code class="language-plaintext highlighter-rouge">parallelStream()</code>을 사용하고 <code class="language-plaintext highlighter-rouge">isParallel()</code>메서드를 통해 병렬 여부를 확인할 수 있다. 이외에도 일반적인 순차 Stream으로 진행하던 중 <code class="language-plaintext highlighter-rouge">parallel()</code> 메서드를 사용해 일부 연산만을 병렬로 처리하게 할 수 있다.</p><p>예제를 통해 어떻게 동작하는지 알아보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">,</span> <span class="s">"e"</span><span class="o">,</span> <span class="s">"f"</span><span class="o">,</span> <span class="s">"g"</span><span class="o">,</span> <span class="s">"h"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">parallelStream</span><span class="o">()</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"map: %s [%s]\n"</span><span class="o">,</span> <span class="n">str</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"forEach: %s [%s]\n"</span><span class="o">,</span> <span class="n">str</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
  <span class="o">});</span>

<span class="cm">/* 실행 결과
map: f [main]
map: a [ForkJoinPool.commonPool-worker-13]
map: d [ForkJoinPool.commonPool-worker-15]
map: c [ForkJoinPool.commonPool-worker-3]
map: b [ForkJoinPool.commonPool-worker-9]
map: g [ForkJoinPool.commonPool-worker-11]
map: h [ForkJoinPool.commonPool-worker-5]
forEach: H [ForkJoinPool.commonPool-worker-5]
map: e [ForkJoinPool.commonPool-worker-7]
forEach: G [ForkJoinPool.commonPool-worker-11]
forEach: B [ForkJoinPool.commonPool-worker-9]
forEach: C [ForkJoinPool.commonPool-worker-3]
forEach: D [ForkJoinPool.commonPool-worker-15]
forEach: A [ForkJoinPool.commonPool-worker-13]
forEach: F [main]
forEach: E [ForkJoinPool.commonPool-worker-7]
*/</span>
</pre></table></code></div></div><p>실행 결과를 통해 각 Stream 연산을 어느 스레드가 수행했는지 확인할 수 있다. 물론 어떤 스레드가 어떤 작업을 수행할지 비결정적이기 때문에 실행에 따라 출력은 달라 질 수 있다.</p><p>Parallel Stream은 내부적으로 공용 ForkJoinPool을 사용하고 <code class="language-plaintext highlighter-rouge">ForkJoinPool.commonPool()</code>을 통해 사용 가능한 공용의 ForkJoinPool의 갯수를 확인할 수 있다. 해당 값은 사용 가능한 물리적인 CPU 코어 수에 따라 다르게 설정된다.</p><p>위 예제는 7개의 ForkJoinPool로 실행되었고 그에 따라 7개의 worker 스레드가 동작한 것을 확인할 수 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nc">ForkJoinPool</span> <span class="n">commonPool</span> <span class="o">=</span> <span class="nc">ForkJoinPool</span><span class="o">.</span><span class="na">commonPool</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">commonPool</span><span class="o">.</span><span class="na">getParallelism</span><span class="o">());</span>

<span class="cm">/* 실행 결과
7
*/</span>
</pre></table></code></div></div><p>또한 이 값은 다음과 같은 JVM 매개변수를 통해 별도로 설정해 줄 수 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">-</span><span class="nc">Djava</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">ForkJoinPool</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">parallelism</span><span class="o">=</span><span class="mi">5</span>
</pre></table></code></div></div><p><br /></p><h3 id="parallel-stream의-정렬">Parallel Stream의 정렬 <a href="#parallel-stream의-정렬" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Parallel Stream에서 정렬이 어떻게 동작하는지 확인해보기 위해 위의 예제코드에 정렬 메서드 <code class="language-plaintext highlighter-rouge">sorted()</code>를 추가했다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">,</span> <span class="s">"e"</span><span class="o">,</span> <span class="s">"f"</span><span class="o">,</span> <span class="s">"g"</span><span class="o">,</span> <span class="s">"h"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">parallelStream</span><span class="o">()</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"map: %s [%s]\n"</span><span class="o">,</span> <span class="n">str</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">sorted</span><span class="o">((</span><span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"sort: %s ? %s [%s]\n"</span><span class="o">,</span> <span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">s1</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">s2</span><span class="o">);</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"forEach: %s [%s]\n"</span><span class="o">,</span> <span class="n">str</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
  <span class="o">});</span>

<span class="cm">/* 실행 결과
map: h [main]
map: a [ForkJoinPool.commonPool-worker-13]
map: e [ForkJoinPool.commonPool-worker-15]
map: f [ForkJoinPool.commonPool-worker-5]
map: c [ForkJoinPool.commonPool-worker-11]
map: b [ForkJoinPool.commonPool-worker-9]
map: d [ForkJoinPool.commonPool-worker-3]
map: g [ForkJoinPool.commonPool-worker-7]
sort: B ? A [main]
sort: C ? B [main]
sort: D ? C [main]
sort: E ? D [main]
sort: F ? E [main]
sort: G ? F [main]
sort: H ? G [main]
forEach: F [main]
forEach: A [ForkJoinPool.commonPool-worker-13]
forEach: C [ForkJoinPool.commonPool-worker-7]
forEach: D [ForkJoinPool.commonPool-worker-5]
forEach: B [ForkJoinPool.commonPool-worker-15]
forEach: E [ForkJoinPool.commonPool-worker-9]
forEach: G [ForkJoinPool.commonPool-worker-11]
forEach: H [ForkJoinPool.commonPool-worker-3]
*/</span>
</pre></table></code></div></div><p>Parallel Stream은 비결정적이기 때문에 실행할 때마다 출력이 다르게 나온다. 하지만 위의 예제를 실행해 보면 map과 forEach는 출력이 바뀌는데 sort는 항상 main 스레드에서 순차적으로 처리되는 것을 확인할 수 있다.</p><p>이러한 이유는 Parallel Stream sort의 내부 동작 방식에 있다. 정렬하고자 하는 배열의 길이가 임계값(프로세스에게 할당 가능한 배열의 길이)보다 작으면 순차적인 정렬 방식인 <code class="language-plaintext highlighter-rouge">Arrays.sort()</code>를 사용하고, 그보다 크면 <code class="language-plaintext highlighter-rouge">parallelSort()</code>를 사용하도록 되어있다. 따라서 위의 예제에서는 배열크기가 작아 순차적으로 처리된 것이다.</p><p><br /></p><h3 id="parallel-stream에서-고려해야-할-사항">Parallel Stream에서 고려해야 할 사항 <a href="#parallel-stream에서-고려해야-할-사항" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Parallel Stream을 이용하면 임의로 스레드 개수를 조정할 수 있어 작업 처리 속도 향상을 기대할 수 있다. 하지만 여기에도 고려해야 할 사항은 있다.</p><p><strong>1) ForkJoinPool의 특성상 나누어지는 job은 균등하게 처리되어야 한다.</strong></p><p>Parallel Stream은 작업을 분할하기 위해 Spliterator의 trySplit()을 사용하는데, 이 분할되는 작업의 단위가 균등하게 나누어져야 하며 나누어지는 작업에 대한 비용이 높지 않아야 순차적 방식보다 효율적으로 처리할 수 있다. Array, ArrayList와 같이 정확한 전체 사이즈를 알 수 있는 경우에는 분할 처리가 빠르고 비용이 적게 들지만, LinkedList의 경우에는 별다른 효과를 찾기 어렵다.</p><p><strong>2) 병렬로 처리되는 작업이 독립적이지 않다면 수행 성능에 영향이 있을 수 있다.</strong></p><p>예를 들어 Stream의 중간 연산 중 sorted() 또는 distinct()와 같은 작업을 수행하는 경우에는 내부적으로 상태에 대한 변수를 각 작업들이 공유(synchronized)하게 되어 있다. 이러한 경우에는 순차적으로 실행하는 경우가 더 효과적일 수 있다.</p><p><br /></p><p>그렇다면 Parallel Stream은 언제 사용해야 할까?</p><p>Parallel Stream은 앞서 설명한 ForkJoinPool 방식을 이용하기 때문에 분할이 잘 이루어질 수 있는 데이터 구조이거나, 작업이 독립적이면서 CPU 사용이 높은 작업에 적합하다고 볼 수 있다.</p><p><br /></p><h2 id="2-flatmap">2. FlatMap <a href="#2-flatmap" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>처리해야 하는 데이터가 2차원 배열 또는 2차원 리스트일 경우, 이를 1차원으로 처리해야 한다면 어떻게 해야 할까? map을 이용한다고 해도 2중 Stream의 형태로 처리될 것이다. 이렇게 중첩 구조를 한 단계 제거하기 위해 사용되는 중간 연산이 flatMap이다.</p><p>인자로 반환형이 Stream인 함수형 인터페이스 Function을 받는다. 즉, flatmap은 중첩된 Stream 구조에서 한 단계 제거하여 새로운 Stream을 생성하고 반환하는 것이다. 이런 작업을 ‘플래트닝(Flattening)’이라고 한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="no">R</span><span class="o">&gt;</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="no">R</span><span class="o">&gt;</span> <span class="nf">flatMap</span><span class="o">(</span><span class="nc">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">T</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="nc">Stream</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">R</span><span class="o">&gt;&gt;</span> <span class="n">mapper</span><span class="o">);</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">// 2차원 배열</span>
<span class="nc">String</span><span class="o">[][]</span> <span class="n">strings</span> <span class="o">=</span> <span class="o">{</span>
  <span class="o">{</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">},</span>
  <span class="o">{</span><span class="s">"d"</span><span class="o">,</span> <span class="s">"e"</span><span class="o">,</span> <span class="s">"f"</span><span class="o">}</span>
<span class="o">};</span>

<span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringStream1</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">strings</span><span class="o">)</span>
  <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="nl">Arrays:</span><span class="o">:</span><span class="n">stream</span><span class="o">);</span>

<span class="c1">// 2중 리스트</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">listList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">),</span>
  <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"d"</span><span class="o">,</span> <span class="s">"e"</span><span class="o">,</span> <span class="s">"f"</span><span class="o">)</span>
<span class="o">);</span>

<span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringStream2</span> <span class="o">=</span> <span class="n">listList</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
  <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="nl">Collection:</span><span class="o">:</span><span class="n">stream</span><span class="o">);</span>
</pre></table></code></div></div><p>2차원 배열과 2중 리스트를 1차원 Stream으로 Flattening 했다. Stream의 요소는 <code class="language-plaintext highlighter-rouge">["a", "b", "c", "d", "e", "f"]</code>가 된다.</p><p><br /></p><h3 id="flatmap-활용-예제">FlatMap 활용 예제 <a href="#flatmap-활용-예제" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>이름과 책 리스트를 가지는 Developer 클래스가 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Developer</span> <span class="o">{</span>
  
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">books</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addBook</span><span class="o">(</span><span class="nc">String</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">books</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="o">}</span>
    <span class="k">this</span><span class="o">.</span><span class="na">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="c1">// Getter, Setter, ToString 생략</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Developer 객체들에 저장된 모든 book 리스트에서 ‘python’을 포함하지 않는 책들을 반환하고자 한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nc">Developer</span> <span class="n">o1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Developer</span><span class="o">();</span>
<span class="n">o1</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"heung"</span><span class="o">);</span>
<span class="n">o1</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="s">"Java 8 in Action"</span><span class="o">);</span>
<span class="n">o1</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="s">"Spring Boot in Action"</span><span class="o">);</span>
<span class="n">o1</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="s">"Effective Java (3nd Edition)"</span><span class="o">);</span>

<span class="nc">Developer</span> <span class="n">o2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Developer</span><span class="o">();</span>
<span class="n">o2</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"tack"</span><span class="o">);</span>
<span class="n">o2</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="s">"Learning Python, 5th Edition"</span><span class="o">);</span>
<span class="n">o2</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="s">"Effective Java (3nd Edition)"</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Developer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">);</span>

<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">collect</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span> <span class="c1">// Stream&lt;Developer&gt;</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Developer:</span><span class="o">:</span><span class="n">getBook</span><span class="o">)</span> <span class="c1">// Stream&lt;Set&lt;String&gt;&gt;</span>
  <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="nl">Collection:</span><span class="o">:</span><span class="n">stream</span><span class="o">)</span> <span class="c1">//Stream&lt;String&gt;</span>
  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">x</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">"python"</span><span class="o">))</span>
  <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toSet</span><span class="o">());</span>

<span class="n">collect</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>

<span class="cm">/* 실행 결과
Spring Boot in Action
Effective Java (3nd Edition)
Java 8 in Action
*/</span>
</pre></table></code></div></div><p>먼저 Developer List Stream에서 map을 사용해 books(Set)를 꺼낸다. 다음 flatMap을 사용해 Set Stream에서 String Stream으로 변환하고 ‘python’을 포함하는 책을 필터링한 결과를 Set으로 반환한다. (같은 책 중복 제거)</p><p><br /></p><h2 id="3-reduce">3. Reduce <a href="#3-reduce" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>누산기(Accumulator)와 연산(Operation)으로 컬렉션에 있는 값을 처리하여 더 작은 컬렉션이나 단일 값을 만드는 작업이다.</p><p>reduce는 여러 요소들을 통해 새로운 결과를 만들어내는데, 최대 3가지의 매개변수를 받을 수 있다.</p><ul><li>Accumulator : 각 요소를 계산한 중간 결과를 생성<li>Identity : 계산을 처리하기 위한 초기값<li>Combiner : Parlallel Stream에서 나누어 계산한 결과를 하나로 합치기 위한 로직</ul><h3 id="31-reduceaccumulator">3.1 reduce(accumulator) <a href="#31-reduceaccumulator" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Optional</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">reduce</span><span class="o">(</span><span class="nc">BinaryOperator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">accumulator</span><span class="o">);</span>
</pre></table></code></div></div><p>BinaryOperator 타입의 accumulator를 매개변수로 받는다. BinaryOperator&lt;T&gt;는 같은 타입의 인자 2개를 받아 동일한 타입의 결과를 반환하는 함수형 인터페이스이다.</p><p>accumulator를 수행하고 Optional 타입의 계산 결과를 반환한다. Stream이 비어있을 경우 값을 계산할 수 없기 때문에 Optional을 반환하는 것이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nc">IntStream</span> <span class="n">intStream</span> <span class="o">=</span> <span class="nc">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span> <span class="c1">// 1, 2, 3, 4</span>

<span class="nc">OptionalInt</span> <span class="n">optionalInt</span> <span class="o">=</span> <span class="n">intStream</span><span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">optionalInt</span><span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>

<span class="cm">/* 실행 결과
10
*/</span>
</pre></table></code></div></div><h3 id="32-reduceidentity-accumulator">3.2 reduce(identity, accumulator) <a href="#32-reduceidentity-accumulator" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="no">T</span> <span class="nf">reduce</span><span class="o">(</span><span class="no">T</span> <span class="n">identity</span><span class="o">,</span> <span class="nc">BinaryOperator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">accumulator</span><span class="o">);</span>
</pre></table></code></div></div><p>Generic 타입의 identity와 BinaryOperator를 매개변수로 받는다. identity는 계산을 처리하기 위한 초기값을 의미한다.</p><p>매개변수 1개를 갖는 reduce와 달리 초기값이 세팅되기 때문에 Optional이 아닌 Generic 타입의 결과를 반환한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nc">IntStream</span> <span class="n">intStream</span> <span class="o">=</span> <span class="nc">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span> <span class="c1">// 1, 2, 3, 4</span>

<span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">intStream</span><span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>

<span class="cm">/* 실행 결과
20
*/</span>
</pre></table></code></div></div><h3 id="33-reduceidentity-accumulator-combiner">3.3 reduce(identity, accumulator, combiner) <a href="#33-reduceidentity-accumulator-combiner" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="no">U</span><span class="o">&gt;</span> <span class="no">U</span> <span class="nf">reduce</span><span class="o">(</span><span class="no">U</span> <span class="n">identity</span><span class="o">,</span> <span class="nc">BiFunction</span><span class="o">&lt;</span><span class="no">U</span><span class="o">,</span> <span class="o">?</span> <span class="kd">super</span> <span class="no">T</span><span class="o">,</span> <span class="no">U</span><span class="o">&gt;</span> <span class="n">accumulator</span><span class="o">,</span> <span class="nc">BinaryOperator</span><span class="o">&lt;</span><span class="no">U</span><span class="o">&gt;</span> <span class="n">combiner</span><span class="o">);</span>
</pre></table></code></div></div><p>identity와 BiFunction 타입의 accumulator, BinaryOperator타입의 combiner를 매개변수로 받는다.</p><p>BiFunction은 2개의 파라미터 타입과 1개의 반환형 모두 서로 다른 Generic 타입을 가질 수 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BiFunction</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">U</span><span class="o">,</span> <span class="no">R</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="no">R</span> <span class="nf">apply</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">,</span> <span class="no">U</span> <span class="n">u</span><span class="o">);</span>
  
  <span class="k">default</span> <span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="nc">BiFunction</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">U</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;</span> <span class="nf">andThen</span><span class="o">(</span><span class="nc">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">R</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="no">V</span><span class="o">&gt;</span> <span class="n">after</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">after</span><span class="o">);</span>
    <span class="k">return</span> <span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">,</span> <span class="no">U</span> <span class="n">u</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">after</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">apply</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">u</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>하지만 BinaryOperator는 BiFunction을 구현(implements)하여 2개의 파라미터 타입과 1개의 반환형 모두 같은 Generic 타입을 갖는다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BinaryOperator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">BiFunction</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span><span class="no">T</span><span class="o">,</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">BinaryOperator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">minBy</span><span class="o">(</span><span class="nc">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">comparator</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">comparator</span><span class="o">);</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">comparator</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">BinaryOperator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">maxBy</span><span class="o">(</span><span class="nc">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">comparator</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">comparator</span><span class="o">);</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">comparator</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>새롭게 추가된 BinaryOperator타입의 combiner는 병렬 처리 시에 각 스레드에서 만들어진 결과를 합치는 작업을 수행한다. 때문에 combiner을 추가하여도 ParallelStream으로 실행하지 않으면 combiner은 호출되지 않는다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"combiner was called"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">});</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>

<span class="cm">/* 실행 결과
16
*/</span>
</pre></table></code></div></div><p>위의 예제는 Parallel Stream이 아니기 때문에 <code class="language-plaintext highlighter-rouge">combiner was called</code>가 출력되지 않는다. 다음 예제를 보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">parallel</span><span class="o">()</span>
  <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"combiner was called"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">});</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>

<span class="cm">/* 실행 결과
combiner was called
combiner was called
36
*/</span>
</pre></table></code></div></div><p>parallel 메서드를 사용해 스트림이 병렬로 처리되도록 하고 reduce를 실행했다. 결과를 보면 combiner가 두 번 실행된 것을 확인할 수 있다. 그 이유는 Stream의 각 요소(1, 2, 3)가 병렬로 처리되고, 처리된 결과를 하나의 결과값으로 만드는 연산이 두 번 발생하기 때문이다.</p><p>즉, 병렬로 처리된 11(10+1), 12(10+2), 13(10+3)에서 역순으로 13 + 12를 먼저 더하고 25 + 11을 더해 combiner가 총 2번 호출되며 최종적으로 36이라는 결과를 만들어 낸다. 초기값(10) 또한 병렬로 발생하는 것을 주의하자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">parallel</span><span class="o">()</span>
  <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"combiner was called"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">});</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>

<span class="cm">/* 실행 결과
combiner was called
combiner was called
16
*/</span>
</pre></table></code></div></div><p>초기값이 한 개만 필요할 경우, 위와같이 identity는 0을 넘기고 reduce의 계산된 결과값에 초기값을 더해야 한다.</p><p>여기서 또 주목해야 할 것은 병렬 스트림의 경우 combiner라는 추가 연산이 발생한다는 것이다. 때문에 간단한 작업에 병렬 연산을 적용하면 오리혀 처리 속도가 느려질 수 있음을 고려해야 한다.</p><p><br /></p><h2 id="4-null-safe-stream">4. Null-Safe Stream <a href="#4-null-safe-stream" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Java를 이용해 개발을 하다 보면 NPE(NullPointException)가 자주 발생한다. 물론 NPE를 방지하기 위해 null 여부를 검사하는 로직을 작성해 줄 수 있지만 이러한 코드는 가독성이 떨어진다.</p><p>이 문제를 해결하기 위해 Java 8에서부터는 Optional이라는 Wrapper 클래스를 제공한다. Stream API 역시 이 Optional의 도움을 받아 Null-Safe한 Stream을 생성할 수 있다.</p><p>(Optional에 대해 잘 알지 못한다면 이전의 <a href="https://heung27.github.io/posts/optional/">Optional</a> 포스팅을 참고하길 바란다.)</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">collectionToStream</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">collection</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">collection</span><span class="o">)</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Collection:</span><span class="o">:</span><span class="n">stream</span><span class="o">)</span>
    <span class="o">.</span><span class="na">orElseGet</span><span class="o">(</span><span class="nl">Stream:</span><span class="o">:</span><span class="n">empty</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위 코드는 컬렉션을 인자로 받아 Optional 객체로 만들고 Stream 생성 후 리턴하는 메서드이다. 만약 컬렉션이 null인 경우 Empty Stream을 반환한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nullList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="c1">// NPE 발생</span>
<span class="n">nullList</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">String:</span><span class="o">:</span><span class="n">length</span><span class="o">)</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">));</span> <span class="c1">// NPE</span>

</pre></table></code></div></div><p>NPE가 발생하는 상황을 가정해보았다. null의 Stream을 생성하려고 하니 당연히 NPE가 발생한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nullList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="c1">// Empty Stream으로 처리</span>
<span class="n">collectionToStream</span><span class="o">(</span><span class="n">nullList</span><span class="o">)</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">String:</span><span class="o">:</span><span class="n">length</span><span class="o">)</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span> <span class="c1">// []</span>
</pre></table></code></div></div><p>우리가 만든<code class="language-plaintext highlighter-rouge">collectionToStream()</code> 메서드를 사용하면 NPE가 발생하는 대신 Empty Stream으로 작업을 마칠 수 있다.</p><p><br /></p><h2 id="5-실행-순서">5. 실행 순서 <a href="#5-실행-순서" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Stream API는 실행 순서를 고려하지 않고 잘 못 사용하면 처리 속도의 지연을 야기할 수 있다. 때문에 작성한 Stream API 코드가 정확히 어떻게 동작하는지 이해하는 것이 중요하다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">,</span> <span class="s">"e"</span><span class="o">,</span> <span class="s">"f"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"filter: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"forEach: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
  <span class="o">});</span>

<span class="cm">/* 실행 결과
filter: a
forEach: a
filter: b
forEach: b
filter: c
forEach: c
filter: d
forEach: d
*/</span>
</pre></table></code></div></div><p>실행 결과를 보면 모든 요소에 대해 filter가 진행되고 forEach가 실행되는 수평적 구조로 처리하는 것이 아니라, 각각의 요소에 대해 filter와 forEach가 먼저 수행되는 수직적 구조로 처리하는 것을 알 수 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">)</span> 
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"anyMatch: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"A"</span><span class="o">);</span>
  <span class="o">});</span>

<span class="cm">/* 실행 결과
map: a
anyMatch: A
*/</span>
</pre></table></code></div></div><p>위의 예제는 Stream의 각 요소를 대문자로 변환하고, 변환된 데이터 중 “A”로 시작하는 문자열이 있는지 검사하는 로직이다. 만약 Stream의 연산이 수평적 구조로 처리된다면 위의 결과는 map 4번(a, b, c, d) + anyMatch 1번(a) 실행될 것이다. 하지만 실제로 연산은 수직적 구조로 처리되기 때문에 map 1번 + anyMatch 1번 실행된 것을 확인할 수 있다.</p><p>이러한 처리 방식은 연산의 실행 순서에 따라 전체 연산의 수가 달라지고, 이는 곧 성능에 영향을 미치게 된다. 다음 예제를 통해 자세히 알아보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"filter: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"A"</span><span class="o">);</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"forEach: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
  <span class="o">});</span>

<span class="cm">/* 실행 결과
map: a
filter: A
forEach: A
map: b
filter: B
map: c
filter: C
map: d
filter: D
*/</span>
</pre></table></code></div></div><p>실행 결과를 보면, map과 filter는 Stream의 요소 수 만큼(4번) 호출되었고 forEach는 1번만 호출되었다. filter를 통과한 A라는 문자열에 대해서만 실행된 것이다. 그렇다면 filter를 맨 앞으로 당기면 어떻게 될까.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"filter: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"a"</span><span class="o">);</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"forEach: "</span> <span class="o">+</span> <span class="n">str</span><span class="o">);</span>
  <span class="o">});</span>

<span class="cm">/* 실행 결과
filter: a
map: a
forEach: A
filter: b
filter: c
filter: d
*/</span>
</pre></table></code></div></div><p>위와 같이 수정된 코드는 filter가 5번, map과 forEach가 각각 1번씩 호출되었다. 동일한 입력과 결과에 대해 더 적은 연산으로 처리할 수 있게 된 것이다. 위의 예제는 간단한 예제이기 때문에 연산 횟수에 큰 차이가 없다. 하지만 처리해야 하는 데이터가 많아질수록 그만큼 큰 성능의 차이를 야기할 것이다. 때문에 Stream API를 사용할 때는 반드시 실행 순서를 고려하여 코드를 작성해야 한다.</p><p><br /></p><h2 id="6-지연-처리">6. 지연 처리 <a href="#6-지연-처리" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Stream의 연산은 최종 결과가 만들어 질 때 수행된다. 즉, 결과를 만드는 최종 작업이 수행되지 않는다면 중간 연산은 아무런 동작을 하지 않는다.</p><p>다음은 호출 횟수를 카운트하는 예제이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kt">long</span> <span class="n">counter</span><span class="o">;</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">wasCalled</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">counter</span><span class="o">++;</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">,</span> <span class="s">"e"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">wasCalled</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
  <span class="o">});</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">counter</span><span class="o">);</span>

<span class="cm">/* 실행 결과
0
*/</span>
</pre></table></code></div></div><p>위의 예제는 Stream이 5개의 요소를 가지고 있기 때문에 <code class="language-plaintext highlighter-rouge">wasCalled()</code>가 5번 호출되어 5가 출력될 것으로 예상된다. 하지만 예상과 달리 0이 출력된다. 그 이유는 Stream의 최종 작업이 실행되지 않아 실제로 아무런 동작을 하지 않았기 때문이다.</p><p>최종 작업으로 collect 메서드를 넣은 후 실행 결과를 확인해 보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">,</span> <span class="s">"e"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">str</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">wasCalled</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">();</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">counter</span><span class="o">);</span>

<span class="cm">/* 실행 결과
5
*/</span>
</pre></table></code></div></div><p>이제 처음 예상한 대로 5가 출력되는 것을 확인할 수 있다.</p><p><br /></p><h2 id="related-posts">Related Posts <a href="#related-posts" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://heung27.github.io/posts/stream-api-%EA%B8%B0%EB%B3%B8/">Stream API - 기본</a><li><a href="https://heung27.github.io/posts/optional/">Optional</a><li><a href="https://heung27.github.io/posts/functional-interface/">Functional Interface</a></ul><p><br /></p><h2 id="reference">Reference <a href="#reference" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://mangkyu.tistory.com/112">https://mangkyu.tistory.com/112</a><li><a href="https://futurecreator.github.io/2018/08/26/java-8-streams/">https://futurecreator.github.io/2018/08/26/java-8-streams/</a><li><a href="https://m.blog.naver.com/tmondev/220945933678">https://m.blog.naver.com/tmondev/220945933678</a><li><a href="https://hbase.tistory.com/171">https://hbase.tistory.com/171</a><li><a href="https://12bme.tistory.com/461">https://12bme.tistory.com/461</a><li><a href="https://velog.io/@foeverna/Java-513-%EC%8A%A4%ED%8A%B8%EB%A6%BC-API-Stream-API">https://velog.io/@foeverna/Java-513-%EC%8A%A4%ED%8A%B8%EB%A6%BC-API-Stream-API</a><li><a href="https://mkyong.com/java8/java-8-flatmap-example/">https://mkyong.com/java8/java-8-flatmap-example/</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/language/'>Language</a>, <a href='/categories/java/'>Java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java-8/" class="post-tag no-text-decoration" >Java 8</a> <a href="/tags/stream-api/" class="post-tag no-text-decoration" >Stream API</a> <a href="/tags/functional-interface/" class="post-tag no-text-decoration" >Functional Interface</a> <a href="/tags/lambda/" class="post-tag no-text-decoration" >Lambda</a> <a href="/tags/method-reference/" class="post-tag no-text-decoration" >Method Reference</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-1 pt-1 pb-2"><div class="license-wrapper"></div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Stream API - 고급 - H&#39;s Tech Blog&amp;url=https://github.com/heung27/posts/stream-api-%EA%B3%A0%EA%B8%89/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Stream API - 고급 - H&#39;s Tech Blog&amp;u=https://github.com/heung27/posts/stream-api-%EA%B3%A0%EA%B8%89/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://github.com/heung27/posts/stream-api-%EA%B3%A0%EA%B8%89/&amp;text=Stream API - 고급 - H&#39;s Tech Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/item-21-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%8A%94-%EA%B5%AC%ED%98%84%ED%95%98%EB%8A%94-%EC%AA%BD%EC%9D%84-%EC%83%9D%EA%B0%81%ED%95%B4-%EC%84%A4%EA%B3%84%ED%95%98%EB%9D%BC/">Item 21. 인터페이스는 구현하는 쪽을 생각해 설계하라</a><li><a href="/posts/item-20-%EC%B6%94%EC%83%81-%ED%81%B4%EB%9E%98%EC%8A%A4%EB%B3%B4%EB%8B%A4%EB%8A%94-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%9A%B0%EC%84%A0%ED%95%98%EB%9D%BC/">Item 20. 추상 클래스보다는 인터페이스를 우선하라</a><li><a href="/posts/item-19-%EC%83%81%EC%86%8D%EC%9D%84-%EA%B3%A0%EB%A0%A4%ED%95%B4-%EC%84%A4%EA%B3%84%ED%95%98%EA%B3%A0-%EB%AC%B8%EC%84%9C%ED%99%94%ED%95%98%EB%9D%BC-%EA%B7%B8%EB%9F%AC%EC%A7%80-%EC%95%8A%EC%95%98%EB%8B%A4%EB%A9%B4-%EC%83%81%EC%86%8D%EC%9D%84-%EA%B8%88%EC%A7%80%ED%95%98%EB%9D%BC/">Item 19. 상속을 고려해 설계하고 문서화하라. 그러지 않았다면 상속을 금지하라</a><li><a href="/posts/item-18-%EC%83%81%EC%86%8D%EB%B3%B4%EB%8B%A4%EB%8A%94-%EC%BB%B4%ED%8F%AC%EC%A7%80%EC%85%98%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EB%9D%BC/">Item 18. 상속보다는 컴포지션을 사용하라</a><li><a href="/posts/item-17-%EB%B3%80%EA%B2%BD-%EA%B0%80%EB%8A%A5%EC%84%B1%EC%9D%84-%EC%B5%9C%EC%86%8C%ED%99%94%ED%95%98%EB%9D%BC/">Item 17. 변경 가능성을 최소화하라</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/java-8/">Java 8</a> <a class="post-tag" href="/tags/override/">Override</a> <a class="post-tag" href="/tags/lambda/">Lambda</a> <a class="post-tag" href="/tags/method-reference/">Method Reference</a> <a class="post-tag" href="/tags/constructor/">Constructor</a> <a class="post-tag" href="/tags/functional-interface/">Functional Interface</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/interface/">Interface</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/stream-api-%EA%B8%B0%EB%B3%B8/"><div class="card-body"> <em class="timeago small" data-ts="1645624500" > 2022-02-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Stream API - 기본</h3><div class="text-muted small"><p> Stream API란? Stream API는 데이터를 추상화하고 처리하는데 자주 사용되는 함수들을 정의해둔 API이며 Java 8에서 추가되었다. 여기서 데이터를 추상화하였다는 것은 데이터의 종류와 관계없이 같은 방식으로 데이터를 처리할 수 있다는 것을 의미한다. Java 8 이전에는 배열 또는 컬렉션 인스턴스를 다루기 위해 for 또는 wh...</p></div></div></a></div><div class="card"> <a href="/posts/functional-interface/"><div class="card-body"> <em class="timeago small" data-ts="1645966200" > 2022-02-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Functional Interface</h3><div class="text-muted small"><p> Java는 함수형 프로그래밍 언어가 아닌 객체지향 언어이기 때문에 함수는 일급 객체가 아니다. 그러나 Java 8에서 추가된 Functional Interface(이하 함수형 인터페이스)를 사용하면 일급 객체처럼 다룰 수 있다. 본문에서 함수형 인터페이스에 대해 자세히 알아보자. 일급 객체(First-class citizen)란? 다른 ...</p></div></div></a></div><div class="card"> <a href="/posts/lambda/"><div class="card-body"> <em class="timeago small" data-ts="1649167080" > 2022-04-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Lambda Expression</h3><div class="text-muted small"><p> Java 8부터 도입된 Lambda Expression(이하 람다식)의 개념과 사용 방법을 포스팅합니다. 지난 Stream API, Functional Interface 포스팅에서도 람다식을 언급했습니다. 이처럼 람다식은 다양하게 활용되고 있는데요. 본문에서는 람다식에만 포커스를 맞춰 자세히 알아보겠습니다. 람다식이란? 람다식(Lambda...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/functional-interface/" class="btn btn-outline-primary" prompt="Older"><p>Functional Interface</p></a> <a href="/posts/lambda/" class="btn btn-outline-primary" prompt="Newer"><p>Lambda Expression</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/heung27">Jin Heung An</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/java-8/">Java 8</a> <a class="post-tag" href="/tags/override/">Override</a> <a class="post-tag" href="/tags/lambda/">Lambda</a> <a class="post-tag" href="/tags/method-reference/">Method Reference</a> <a class="post-tag" href="/tags/constructor/">Constructor</a> <a class="post-tag" href="/tags/functional-interface/">Functional Interface</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/interface/">Interface</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-J2QJ5KLVPE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-J2QJ5KLVPE'); }); </script>
